<%-include("../partials/head",{title:title})%>
<%-include("../partials/header",{user:user})%>

    <div id="appIndex">
      <%if(typeof user=="object"){%> 
        <div id="addNewTask">
          <h2>Добавить новую заметку</h2>
          <input type="button" value="Новая заметка" @click="handleNew">
        </div>
      <%}%>
      <task :tasks="task_list" :task-edit="handleEdit"></task>
    </div>

  <script>
    Vue.createApp({
      data(){
        return{
          task_list:[]
        }
      },
      methods:{
        async getServer(){
          const res = await fetch("http://localhost:8000/get-tasks")
          const buffer = await res.json()
          buffer.forEach(item=>{
            item.data_add_task = item.data_add_task.match(/^\d{4}-\d{2}-\d{2}/)
            item.data_completion_task = item.data_completion_task.match(/^\d{4}-\d{2}-\d{2}/)
            this.task_list.push(item)
          })
        },
        async handleEdit(task){
         // task.data_completion_task = 
            location.href = `http://localhost:8000/get-edit-tasks?title=${task.title_task}&describe=${task.describe_task}&data-completion=${task.data_completion_task}`
          console.log(task)
        },
        async handleNew(){
          location.href = "http://localhost:8000/add-new"
        }
        
      },
      mounted(){
        this.getServer()
      }
    }).component("task",{
      props:["tasks", "taskEdit"],
      template:`
      <div v-for="item in tasks">
        <div style='border: 1px solid black;'>
          <h6>Дата добавления {{item.data_add_task[0]}}</h6>
          <h6>Дата завершения {{item.data_completion_task[0]}}</h6>
          <h2>{{item.title_task}}</h2>
          <h4>{{item.describe_task}}</h4>
          <div><input type='button' @click='taskEdit(item)' value='Изменить'/></div>
        </div>
      </div>`
    }).mount("#appIndex")
  </script>
</body>
</html>